<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Picture Inspection</title>

    <link rel="shortcut icon" type="x-icon" href="./images/photograph.png">

    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"
        integrity="sha384-b6lVK+yci+bfDmaY1u0zE8YYJt0TZxLEAFyYSLHId4xoVvsrQu3INevFKo+Xir8e" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
        integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Material Icons CDN -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@48,400,0,0" />

     <!-- CSS File -->
     <link rel="stylesheet" href="/static/settingspage/settings.css">

     <!-- Boxicon Css File -->
     <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
     <style>
         #vidSettings{
             -webkit-transform:  translateY(-100%) rotate(0deg) ;
             transform:  translateY(-100%) rotate(180deg);
             -webkit-transform-origin: left bottom;
             transform-origin: left bottom;
             margin-left: 100%;
         }
 
     </style>
</head>

<body>
    <div class="container">
        <aside>
            <div class="top">
                <div class="logo">
                    <img src="/static/images/logoMain.png">
                    <!-- <h2>CON<span class="danger">SOLE</span></h2> -->
                </div>
                <div class="close" id="close-btn">
                    <span class="material-symbols-sharp">close</span>
                </div>
            </div>
            <div class="sidebar">
                <a href="{% url 'home' %}">
                    <span class="material-symbols-sharp">dashboard</span>
                    <h3>Inspection Summary</h3>
                </a>
                <a href="{% url 'results_page' %}">
                    <span class="material-symbols-sharp">bar_chart</span>
                    <h3>Batch Summary</h3>
                </a>
                <a href="{% url 'quality_check_page' %}">
                    <span class="material-symbols-sharp">frame_inspect</span>
                    <h3>Start Inspection</h3>
                </a>
                <a href="{% url 'faqs' %}">
                    <span class="material-symbols-sharp">lab_profile</span>
                    <h3>View Reports</h3>
                </a>
                <a href="{% url 'about' %}" class="active">
                    <span class="material-symbols-sharp">settings</span>
                    <h3>Controls</h3>
                </a>
                <a href="#">
                    <span class="material-symbols-sharp">menu_book</span>
                    <h3>User Guide</h3>
                </a>
                <a href="#">
                    <span class="material-symbols-sharp">help</span>
                    <h3>About Us</h3>
                <a href="{% url 'logout' %}">
                    <span class="material-symbols-sharp">logout</span>
                    <h3>LOG<text class="danger">OUT</text></h3>
                </a>
            </div>
        </aside>
        
        <div class="inspectionBodySettings">
            <div class="inspectionMainSettings">
                <div class="inspectionContainerSettings">
                    <div class="inspectionCameraWords">
                        <h1>Set The Camera View</h1>
                    </div>
                    <div class="main_inspectionSettings">

                        <div class="ccassSettings">

                            <div class="cameraMainVideoSettings">
                                <div class="cameraVideoSettings">
                                    <video id="vidSettings" autoplay></video>
                                </div>
                                <div class="allPicturesButtons">
                                    <div class="startCameraAndTakePicture">
                                        <div class="startCamera">
                                            <button class="startCameraBtn" id="start-cam-btn" onclick="start();">Start Camera</button>
                                        </div>
                                        <!-- <div class="takePicture">
                                            <button class="takePictureBtn" onclick="stop();">Take Picture</button>
                                        </div> -->
                                        <div class="chooseSize">
                                            <input type="text" class="textSize" placeholder="Select Size" readonly>
                                            <div class="chooseSizeOption">
                                                <div onclick="showSize('Medium')">
                                                    <ion-icon name="resize-outline"></ion-icon>Medium
                                                </div>
                                                <div onclick="showSize('Large')">
                                                    <ion-icon name="expand-outline"></ion-icon>Larger
                                                </div>
                                                <div>
                                                    <ion-icon name="alert-circle-outline"></ion-icon>None
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="restartAndStop">

                                        <div class="angleUp">
                                            <button class="angleUpBtn" title="Up Button" value="up" onclick="camera_adjust(this)"><i
                                                    class="fa-solid fa-angles-up"></i></button>
                                        </div>

                                        <div class="angleRightLeft">

                                            <div>
                                                <button class="angleLeftBtn" title="Left Button" value="left" onclick="camera_adjust(this)"><i
                                                        class="fa-solid fa-angles-left"></i></button>
                                            </div>
                                            <div>
                                                <button class="angleRightBtn" title="Right Button" value="right" onclick="camera_adjust(this)"><i
                                                        class="fa-solid fa-angles-right"></i></button>
                                            </div>

                                        </div>

                                        <div class="angleDown">

                                            <button class="angleDownBtn" title="Down Button" value="down" onclick="camera_adjust(this)"><i
                                                    class="fa-solid fa-angles-down"></i></button>
                                        </div>
                                    </div>

                                    <!-- <div class="setCamera">
                                        <button class="setCameraBtn"><i class="fa-regular fa-circle-check"></i> Set The
                                            Camera</button>
                                    </div> -->

                                </div>

                            </div>

                        </div>
                    </div>

                </div>

                <div class="mainNedLogos">
                    <div class="nedLogos">
                        <img src="/static/settingspage/nedlogo.png" alt="">
                    </div>
                </div>
            </div>
        </div>
        

        <div class="right">
            <div class="top">
                <button id="menu-btn">
                    <span class="material-symbols-sharp">menu</span>
                </button>
                <div class="theme-toggler">
                    <span class="material-symbols-sharp active">light_mode</span>
                    <span class="material-symbols-sharp">dark_mode</span>
                </div>
            </div>
        </div>
        

        <script src="./static/homepage/index.js"></script>
        <script src="https://code.jquery.com/jquery-latest.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

        <script>
            var count = 0;
            const cameraButton = document.querySelector('.cameraMainVideoSettings');
            var vidElement = null;
            function start() {
                var camAvailable = navigator.mediaDevices && navigator.mediaDevices.getUserMedia;
                if (camAvailable) {
                    if (count==0){
                        vidElement = document.getElementById("vidSettings");
                        navigator.mediaDevices.getUserMedia({ video: true }).then(function (stream) {
                            vidElement.srcObject = stream;
                            vidElement.play();
                        });
                        count=1;
                        document.getElementById("start-cam-btn").innerHTML = "Stop Camera"
                    }
                    else{
                        stop();
                        count = 0;
                        document.getElementById("start-cam-btn").innerHTML = "Start Camera"
                    }
                }
                else{
                    alert("No camera available")
                }
                
            }
            function stop() {
                //vidElement.pause();
                //vidElement.currentTime = 0;
                navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
                    vidElement.srcObject = null;
                });
            } 
            
            function camera_adjust(direction){

                let direction_cam = direction.value;
                if(count==1){
                    if (direction_cam==="up" || direction_cam==="down"){
                        if (size_of_bottle == ""){
                            alert("Select Bottle Size first")
                            return
                        }
                        $.ajaxSetup({
                            data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
                        });
                        ajaxCall = $.ajax({
                            type: 'POST',
                            url: "{% url 'align_camera' %}",
                            data: {"direction":direction_cam, "bottle_size": size_of_bottle},
                            success: function(response){
                                console.log("success");

                            },
                            
                            error: function (response) {
                                console.log(response);
                            }
                        });

                    }

                    else{

                        $.ajaxSetup({
                            data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
                        });
                        ajaxCall = $.ajax({
                            type: 'POST',
                            url: "{% url 'rotate_motor' %}",
                            data: {"direction": direction_cam},
                            success: function(response){
                                console.log("success");

                            },
                            
                            error: function (response) {
                                console.log(response);
                            }
                        });

                    }
                }
                else{
                    alert("Start camera first!");
                }
            }

        </script>









        <script>
            var size_of_bottle = "";
            function showSize(anythingSize) {
                document.querySelector('.textSize').value = anythingSize;
                size_of_bottle = anythingSize
                console.log(size_of_bottle)
            }
            let chooseSize = document.querySelector('.chooseSize');
            chooseSize.onclick = function () {
                chooseSize.classList.toggle('active');
            }
        </script>
        <!-- SCRIPT OF SIZE SELECTION -->
</body>

</html>